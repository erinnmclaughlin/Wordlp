@inject Game Game
@inject NavigationManager NavigationManager
@implements IDisposable

@if (IsActive)
{
    <div class="modal-background" @onclick="Close"></div>

    <div class="modal">
        <button class="close" type="button" @onclick="Close">
            <i class="fa-solid fa-close fa-xl" />
        </button>

        <div class="solution">@Game.Solution.Value</div>
        <div class="modal-content">
            <p>@Game.Solution.Description</p>
        </div>

        <GameOverButtons />
    </div>
}

@code {

    private bool IsActive { get; set; }

    public void Dispose()
    {
        Game.OnGameOver -= OnGameOver;
        Game.OnGameStart -= OnGameStart;
        NavigationManager.LocationChanged -= OnLocationChanged;
    }

    protected override void OnInitialized()
    {
        Game.OnGameOver += OnGameOver;
        Game.OnGameStart += OnGameStart;
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    public void Close()
    {
        IsActive = false;
        StateHasChanged();
    }

    private void Show()
    {
        IsActive = true;
        StateHasChanged();
    }

    private void OnGameOver(object? o, EventArgs e) => Show();
    private void OnGameStart(object? o, EventArgs e) => Close();
    private void OnLocationChanged(object? o, LocationChangedEventArgs e) => Close();
}
